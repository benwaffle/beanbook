<section class="container" style="margin-top: 20px">
  {{#with bean}}
  <div class="card">
    <div class="card-image">
      <img src="{{imageUrl}}" />
    </div>
    <div class="card-content">
      <form action="" method="post" id="editform">
        <input type="hidden" name="_id" value="{{_id}}"/>
        <input type="hidden" name="creatorId" value="{{creatorId}}"/>
        <div class="media">
          <div class="media-content">
            <p class="title" id="title">{{title}}</p>
            <p class="subtitle">@
              <a href="/user/{{creatorId}}">{{creatorId}}</a>
            </p>
          </div>
        </div>
        <div class="content" id="desc">
          <span>{{description}}</span>
          <br>
          <time>{{moment timestamp}}</time>
        </div>
        {{#if ../editable}}
        <a class="button" id="edit">Edit</button>
        <a href="/bean/delete/{{_id}}" class="button is-danger" onclick="return confirm('Are you sure you want to delete this bean?')">Delete</a>
        {{/if}}
      </form>
    </div>
  </div>
  {{/with}}
</section>
<script>
  const $ = document.querySelector.bind(document);
  const $$ = document.querySelectorAll.bind(document);
  let editing = false;
  document.addEventListener('DOMContentLoaded', () => {
    $('#edit').addEventListener('click', (ev) => {
      if (editing) {
        $('#editform').submit();
      } else {
        editing = true;
        $('#edit').textContent = 'Save';
        $('#edit').type = 'submit';

        const title = document.createElement('input');
        title.classList.add('title');
        title.name = 'title';
        title.value = $('#title').textContent;
        const p = $('#title').parentElement;
        $('#title').remove();
        p.prepend(title);

        const desc = document.createElement('textarea');
        desc.name = 'description';
        desc.value = $('#desc > span').textContent;
        const s = $('#desc');
        for (const child of $$('#desc > *'))
          child.remove();
        s.append(desc);
      }
    });
  });
</script>
